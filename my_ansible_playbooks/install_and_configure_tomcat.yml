---
  - hosts: 52.66.113.151
    gather_facts: false
    vars:
      req_java: java-1.8.0-openjdk
      set_java: jre-1.8.0-openjdk
      req_tomcat_ver: 10.0.4
      tomcat_url: https://ftp.wayne.edu/apache/tomcat/tomcat-{{req_tomcat_ver.split('.')[0]}}/v{{req_tomcat_ver}}/bin/apache-tomcat-{{req_tomcat_ver}}.tar.gz
      tomcat_port: 8090
    become: yes
    become_method: sudo
    tasks: 
      - name: updating repos
        yum: 
          name: "*"
          state: latest
      - name: installing required java
        yum:
          name: "{{req_java}}"
          state: present
      - name: setting default java
        alternatives:
          name: java
          link: /usr/bin/java
          path: /usr/lib/jvm/{{set_java}}/bin/java
      - name: downloading required tomcat
        get_url:
          url: "{{tomcat_url}}"
          dest: /usr/local        
      - name: Extracting downloaded tomcat
        unarchive:
          src: "/usr/local/apache-tomcat-{{req_tomcat_ver}}.tar.gz"
          dest: /usr/local
          remote_src: yes
      - name: cheecking the file is exists or not
        stat:
          path: /usr/local/latest/apache-tomcat-{{req_tomcat_ver}}
        register: out
      - name: renaming tomcat server
        command: mv /usr/local//apache-tomcat-{{req_tomcat_ver}}  /usr/local/latest
        when: out.stat.exists == False
      - name:
        template: 
          src: server.xml.j2
          dest: /usr/local/latest/conf/server.xml
      - name: starting tomcat
        shell: nohup /usr/local/latest/bin/startup.sh &

